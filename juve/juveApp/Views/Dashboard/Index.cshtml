@{
    ViewData["Title"] = "Admin Dashboard";
    var stats = ViewBag.Stats as juveApp.Services.DashboardStats;
    var pendingRequests = ViewBag.PendingRequests as List<juveApp.Models.CommunityRequest>;
    var headlines = ViewBag.Headlines as List<juveApp.Models.Headline>;
    var searchResults = ViewBag.SearchResults as List<juveApp.Models.User>;
    var searchQuery = ViewBag.SearchQuery as string;
}

<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-8">Admin Dashboard</h1>

    <!-- Statistics Overview -->
    <div hx-get="/dashboard/stats" hx-trigger="updateStats from:body" hx-swap="innerHTML">
        @await Html.PartialAsync("_DashboardStats", stats)
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Pending Requests & Headlines -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Pending Community Requests -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-yellow-500 text-white px-6 py-4 rounded-t-lg">
                    <h2 class="text-2xl font-bold">Pending Community Requests</h2>
                </div>
                <div id="pending-requests-container" class="p-6">
                    @await Html.PartialAsync("_PendingRequests", pendingRequests)
                </div>
            </div>

            <!-- Recent Headlines -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-blue-600 text-white px-6 py-4 rounded-t-lg">
                    <h2 class="text-2xl font-bold">Recent Headlines</h2>
                </div>
                <div class="p-6">
                    @await Html.PartialAsync("_HeadlinesList", headlines ?? new List<juveApp.Models.Headline>())
                </div>
            </div>

            <!-- Pending Feedback -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-yellow-700 text-white px-6 py-4 rounded-t-lg">
                    <h2 class="text-2xl font-bold">Pending Feedback</h2>
                </div>
                <div class="p-6">
                    @{
                        var pendingFeedback = ViewBag.PendingFeedback as List<juveApp.Models.SupportFeedback>;
                    }
                    @await Html.PartialAsync("_PendingFeedback", pendingFeedback ?? new
                    List<juveApp.Models.SupportFeedback>())
                </div>
            </div>
        </div>

        <!-- User Search -->
        <div class="bg-white rounded-lg shadow-md">
            <div class="bg-gray-700 text-white px-6 py-4 rounded-t-lg">
                <h2 class="text-xl font-bold">Find User</h2>
            </div>
            <div class="p-6">
                <form asp-action="SearchUser" method="post" hx-post="/dashboard/search-user" hx-target="#search-results"
                    hx-swap="outerHTML">
                    @Html.AntiForgeryToken()
                    <div class="mb-4">
                        <input type="text" name="username" placeholder="Enter username" value="@searchQuery"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Search
                    </button>
                </form>

                @if (searchResults != null && searchResults.Any())
                {
                    @await Html.PartialAsync("_UserSearchResults", searchResults)
                }
                else if (!string.IsNullOrEmpty(searchQuery))
                {
                    <div id="search-results">
                        <p class="mt-4 text-gray-500">No users found matching "@searchQuery"</p>
                    </div>
                }
                else
                {
                    <div id="search-results"></div>
                }
            </div>
        </div>

        <!-- Create Headline -->
        <div class="bg-white rounded-lg shadow-md">
            <div class="bg-green-600 text-white px-6 py-4 rounded-t-lg">
                <h2 class="text-xl font-bold">Post Headline</h2>
            </div>
            <div class="p-6">
                <form asp-action="CreateHeadline" method="post" hx-post="/dashboard/create-headline"
                    hx-target="#headlines-list" hx-swap="outerHTML"
                    hx-on::after-request="if(event.detail.successful) this.reset()">
                    @Html.AntiForgeryToken()
                    <div class="mb-4">
                        <textarea name="content" rows="4" placeholder="Enter headline message..."
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <button type="submit"
                        class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Post Headline
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
</div>